<div id="click-to-top" class="click-to-top">
  <i class="fa-solid fa-chevron-up"></i>
</div>
<script>
  (function () {
    const clickToTop = document.getElementById('click-to-top');

    function getPagination() {
      return document.querySelector('.pagination');
    }

    function updateVisibility() {
      const pagination = getPagination();
      if (window.scrollY > 100 || (pagination && pagination.scrollTop > 0)) {
        clickToTop.classList.add('show');
      } else {
        clickToTop.classList.remove('show');
      }
    }

    // Window scroll visibility
    window.addEventListener('scroll', updateVisibility, { passive: true });

    // Detect user scrolling inside pagination even if it is dynamically replaced
    document.addEventListener('wheel', function (e) {
      if (e.target && e.target.closest && e.target.closest('.pagination')) {
        updateVisibility();
      }
    }, { passive: true });

    // For touch devices
    document.addEventListener('touchmove', function (e) {
      if (e.target && e.target.closest && e.target.closest('.pagination')) {
        updateVisibility();
      }
    }, { passive: true });

    function isAtBottom() {
      return (window.innerHeight + window.scrollY) >= (document.body.scrollHeight - 10);
    }

    clickToTop.addEventListener('click', () => {
      const atBottom = isAtBottom();
      const pagination = getPagination();

      if (pagination && (atBottom || pagination.scrollTop > 0)) {
        // If at bottom, scroll pagination first then window; if pagination scrolled, scroll it only
        if (typeof smoothScrollElementTo === 'function') {
          if (atBottom) {
            smoothScrollElementTo(pagination, 0, 300, function() {
              if (typeof smoothScrollTo === 'function') smoothScrollTo(0, 300);
            });
          } else {
            smoothScrollElementTo(pagination, 0, 300);
          }
        } else if (pagination.scrollTo) {
          if (atBottom) {
            pagination.scrollTo({ top: 0, behavior: 'smooth' });
            if (typeof window.scrollTo === 'function') window.scrollTo({ top: 0, behavior: 'smooth' });
          } else {
            pagination.scrollTo({ top: 0, behavior: 'smooth' });
          }
        } else {
          pagination.scrollTop = 0;
          if (atBottom && typeof smoothScrollTo === 'function') smoothScrollTo(0, 300);
        }
        return;
      }

      if (typeof smoothScrollTo === 'function') {
        smoothScrollTo(0);
      } else {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    });

    // Initial visibility check
    updateVisibility();
  })();
</script>
